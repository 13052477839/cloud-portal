---
- hosts: all
  become: true

  tasks:
  
    - name: Copy system scripts to temp folder
      copy:
        src: "linux_scripts"
        dest: "/tmp"
        owner: "{{ ansible_env.SUDO_USER }}"
        group: "{{ ansible_env.SUDO_USER }}"
        mode: 0755 
        
    - name: Copy user script to temp folder
      copy:
        src: "{{ script_file }}"
        dest: "/tmp/linux_scripts/user.sh"
        owner: "{{ ansible_env.SUDO_USER }}"
        group: "{{ ansible_env.SUDO_USER }}"
        mode: 0755
        
    - name: Execute prepare script             
      shell: "bash /tmp/linux_scripts/prepare.sh"
      register: out
    
    - debug: var=out.stdout_lines
                                 
    - name: Execute user script             
      shell: "bash /tmp/linux_scripts/user.sh"
      register: out
    
    - debug: var=out.stdout_lines
                                 
    - name: Execute cleanup script             
      shell: "bash /tmp/linux_scripts/cleanup.sh"
      register: out
    
    - debug: var=out.stdout_lines